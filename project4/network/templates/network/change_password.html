{% extends 'network/layout.html' %}

{% block title %}Change Password{% endblock %}

{% block body %}
<script>
let message;
function checkPassword(container) {
    // get all input fields
    const currentPassword = document.querySelector('#current_password').value;
    const newPassword = document.querySelector('#new_password').value;
    const confirmPassword = document.querySelector('#confirm_password').value;

    message = document.querySelector('#change-password-message');

    // if fields are blank
    if (currentPassword == '' || newPassword == '' || confirmPassword == '') {
        message.style.display = 'block';
        message.innerHTML = 'Please fill out all the required fields.';
        return
    }

    if (newPassword !== confirmPassword) {
        message.style.display = 'block';
        message.innerHTML = 'Passwords do not match.';
        return
    }

    fetch(`/api/password/${currentUserID}`, {
        method: 'PUT',
        body: JSON.stringify({
            new_password: newPassword
        })
    })
    .then(response => response.json())
    .then(result => {
        console.log(result);
    });

};


// if user presses enter key, run checkPassword
document.addEventListener('keydown', (event) => {
    if (event.key === 'Enter') {
        const container = document.querySelector('#change-password-form');
        checkPassword(container);
    }
    else {
        message.style.display = 'none';     // remove fill out fields message
    }
});
</script>
    <h1 id="change-password-title">Change Password</h1>

    <form id="change-password-form" method="post" action="{% url 'change_password' %}">
        {% csrf_token %}
        <div class="form-group">
            <label for="current_password">Current Password: </label>
            <input id="current_password" name="current_password" placeholder="Current Password" type="password">
        </div>
        <div class="form-group">
            <label for="new_password">New Password: </label>
            <input id="new_password" name="new_password" placeholder="New Password" type="password">
        </div>
        <div class="form-group">
            <label for="confirm_password">Confirm New Password: </label>
            <input id="confirm_password" name="confirm_password" placeholder="Confirm New Password" type="password">
        </div>
        <p onclick=checkPassword(this.parentNode) class="btn btn-success">Change Password</p>
    </form>

    <div id="change-password-message"></div>

{% endblock %}